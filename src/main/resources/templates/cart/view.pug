extends ../layout

block content
  .cart
    .cart__header
      h2.cart__header-title Shopping Cart

    if message
      .alert.alert--success(data-test="cart-success-message")= message

    if error
      .alert.alert--error(data-test="cart-error-message")= error

    if shoppingCart.lineItems() && shoppingCart.lineItems().size() > 0
      .cart__summary
        .cart__summary-row
          span Total Items: #{shoppingCart.itemCount()}
          span Total Quantity: #{shoppingCart.totalQuantity()}

      if shoppingCart.hasAnyPriceChanges()
        .price-change-summary(data-test="price-change-summary")
          | Some items have price changes since they were added to your cart.

      .cart__items(data-test="cart-items")
        each item in shoppingCart.lineItems()
          .cart__item(data-test="cart-item")
            .cart__item-image
              if item.imageUrl()
                img(src=item.imageUrl() alt=item.productName())
            .cart__item-details
              .cart__item-name= item.productName()
              .cart__item-info
                .cart__item-row
                  span.cart__item-label Quantity
                  span.cart__item-value= item.quantity()
                .cart__item-row
                  span.cart__item-label Unit Price
                  span.cart__item-value #{item.unitPrice()} #{item.currencyCode()}
                .cart__item-row
                  span.cart__item-label Line Total
                  span.cart__item-price #{item.lineTotal()} #{item.currencyCode()}

              if item.hasPriceChanged() && item.priceChange()
                if item.priceChange().increased()
                  .price-change.price-change--increased(data-test="price-change-alert") Price increased by #{item.priceChange().difference()} #{item.priceChange().currencyCode()}
                else
                  .price-change.price-change--decreased(data-test="price-change-alert") Price decreased by #{item.priceChange().difference()} #{item.priceChange().currencyCode()}

              if !item.isAvailable()
                .stock-alert.stock-alert--danger(data-test="stock-alert") Product no longer available
              else if !item.hasSufficientStock()
                .stock-alert.stock-alert--warning(data-test="stock-alert") Insufficient stock available

      .cart__total
        .cart__total-row
          span Subtotal
          span #{shoppingCart.totals().currentSubtotal()} #{shoppingCart.totals().currencyCode()}

      .cart__actions
        if shoppingCart.status() === 'ACTIVE'
          if shoppingCart.canCheckout()
            a.btn.btn--primary.btn--lg(href='/checkout/start?cartId=' + shoppingCart.cartId() data-test="cart-checkout-link") Proceed to Checkout
            .cart__actions-info
              a(href="/products") Continue Shopping
          else
            button.btn.btn--disabled.btn--lg(disabled data-test="cart-checkout-disabled") Cannot Checkout
            .cart__actions-warning Some items are unavailable or have insufficient stock
        else
          .status-badge
            if shoppingCart.status() === 'CHECKED_OUT'
              span.badge.badge--success Checked Out
            else if shoppingCart.status() === 'COMPLETED'
              span.badge.badge--info Order Completed
            else if shoppingCart.status() === 'ABANDONED'
              span.badge.badge--warning Abandoned

    else
      .empty-state
        .empty-state__icon &#128722;
        h3.empty-state__title Your cart is empty
        p.empty-state__message Browse our products to find something you'll love.
        a.btn.btn--primary(href="/products" data-test="cart-browse-link") Browse Products
