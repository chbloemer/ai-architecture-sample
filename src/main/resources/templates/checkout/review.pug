extends ../layout

block content
  .checkout
    .checkout__progress(data-test="checkout-progress")
      .checkout__step.checkout__step--completed Buyer Info
      .checkout__step.checkout__step--completed Delivery
      .checkout__step.checkout__step--completed Payment
      .checkout__step.checkout__step--active Review

    if error
      .alert.alert--error(data-test="review-error-message")= error

    .review-sections(data-test="review-sections")
      .review-section(data-test="review-buyer-section")
        .review-section__header
          h3.review-section__title Buyer Information
          a.review-section__edit(href="/checkout/buyer" data-test="review-buyer-edit-link") Edit
        if orderReview.buyerInfo()
          .review-section__body
            p #{orderReview.buyerInfo().firstName()} #{orderReview.buyerInfo().lastName()}
            p #{orderReview.buyerInfo().email()}
            p #{orderReview.buyerInfo().phone()}
        else
          .review-section__body.review-section__body--incomplete
            p Buyer information not provided
            a.btn.btn--sm(href="/checkout/buyer") Complete

      .review-section(data-test="review-delivery-section")
        .review-section__header
          h3.review-section__title Delivery
          a.review-section__edit(href="/checkout/delivery" data-test="review-delivery-edit-link") Edit
        if orderReview.delivery()
          .review-section__body
            h4 Shipping Address
            p #{orderReview.delivery().address().street()}
            if orderReview.delivery().address().streetLine2()
              p #{orderReview.delivery().address().streetLine2()}
            p #{orderReview.delivery().address().city()}, #{orderReview.delivery().address().postalCode()}
            if orderReview.delivery().address().state()
              p #{orderReview.delivery().address().state()}, #{orderReview.delivery().address().country()}
            else
              p #{orderReview.delivery().address().country()}

            h4 Shipping Method
            p #{orderReview.delivery().shippingOption().name()}
            p Estimated Delivery: #{orderReview.delivery().shippingOption().estimatedDelivery()}
            p Cost: #{orderReview.delivery().shippingOption().cost()} #{orderReview.delivery().shippingOption().currencyCode()}
        else
          .review-section__body.review-section__body--incomplete
            p Delivery information not provided
            a.btn.btn--sm(href="/checkout/delivery") Complete

      .review-section(data-test="review-payment-section")
        .review-section__header
          h3.review-section__title Payment Method
          a.review-section__edit(href="/checkout/payment" data-test="review-payment-edit-link") Edit
        if orderReview.payment()
          .review-section__body
            p #{orderReview.payment().providerId()}
            if orderReview.payment().providerReference()
              p Reference: #{orderReview.payment().providerReference()}
        else
          .review-section__body.review-section__body--incomplete
            p Payment method not selected
            a.btn.btn--sm(href="/checkout/payment") Complete

    if orderReview.lineItems() && orderReview.lineItems().size() > 0
      .order-summary
        h3.order-summary__title Order Items
        each item in orderReview.lineItems()
          .order-summary__item
            .order-summary__item-image
              if item.imageUrl()
                img(src=item.imageUrl() alt=item.productName())
            span.order-summary__item-name #{item.productName()}
            span.order-summary__item-qty x#{item.quantity()}
            span.order-summary__item-price #{item.lineTotal()} #{item.currencyCode()}

        if orderReview.totals()
          .order-summary__line
            span Subtotal
            span #{orderReview.totals().subtotal()} #{orderReview.totals().currencyCode()}
          if orderReview.totals().shipping()
            .order-summary__line
              span Shipping
              span #{orderReview.totals().shipping()} #{orderReview.totals().currencyCode()}
          if orderReview.totals().tax()
            .order-summary__line
              span Tax
              span #{orderReview.totals().tax()} #{orderReview.totals().currencyCode()}
          .order-summary__total
            span Total
            span #{orderReview.totals().total()} #{orderReview.totals().currencyCode()}

    .form__actions
      a.btn.btn--secondary(href="/checkout/payment" data-test="review-back-link") Back
      form(method="post" action="/checkout/confirm" data-test="review-confirm-form")
        button.btn.btn--primary.btn--lg(type="submit" data-test="review-place-order-button") Place Order
