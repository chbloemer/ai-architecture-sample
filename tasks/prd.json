{
  "name": "AI Architecture Sample - E-Commerce Application",
  "description": "Reference implementation demonstrating Domain-Centric Architecture with DDD, Hexagonal Architecture, and Clean Architecture patterns",
  "stories": [
    {
      "id": "US-1",
      "title": "Initial Project Setup & Spring Boot Application",
      "description": "Set up Spring Boot project with Gradle, Pug template engine, and basic web infrastructure for the e-commerce sample application.",
      "acceptance_criteria": [
        "Spring Boot 3.x project with Java 21",
        "Gradle build configuration with required dependencies",
        "Pug4j template engine integration",
        "Basic layout template with navigation",
        "Home page controller and template"
      ],
      "passes": true
    },
    {
      "id": "US-2",
      "title": "ArchUnit Architecture Tests",
      "description": "Set up ArchUnit test infrastructure to enforce architectural rules automatically.",
      "acceptance_criteria": [
        "Separate test-architecture source set with Spock/Groovy",
        "Tests for hexagonal architecture (ports and adapters)",
        "Tests for onion architecture (layer dependencies)",
        "Tests for DDD tactical patterns (aggregates, entities, value objects)",
        "Tests for naming conventions"
      ],
      "passes": true
    },
    {
      "id": "US-3",
      "title": "Product Catalog Bounded Context",
      "description": "Implement Product Catalog bounded context with domain model, repository, and use cases for browsing products.",
      "acceptance_criteria": [
        "Product aggregate with ProductId, Name, Description, Price, Availability",
        "ProductRepository interface in application layer",
        "InMemoryProductRepository implementation",
        "GetAllProductsUseCase for catalog listing",
        "GetProductByIdUseCase for product details",
        "CatalogPageController and ProductDetailPageController",
        "Pug templates for catalog and product detail pages"
      ],
      "passes": true
    },
    {
      "id": "US-4",
      "title": "Use Case Pattern Implementation",
      "description": "Implement use case pattern from Clean Architecture with InputPort/UseCase interfaces and Command/Query objects.",
      "acceptance_criteria": [
        "UseCase<INPUT, OUTPUT> base interface",
        "InputPort marker interface",
        "Use cases organized by bounded context",
        "Command objects for write operations",
        "Query objects for read operations"
      ],
      "passes": true
    },
    {
      "id": "US-5",
      "title": "Shared Kernel & DDD Marker Interfaces",
      "description": "Create shared kernel with DDD marker interfaces and common domain primitives used across bounded contexts.",
      "acceptance_criteria": [
        "AggregateRoot, Entity, Value marker interfaces",
        "DomainEvent and DomainService markers",
        "Repository and OutputPort base interfaces",
        "BaseAggregateRoot with event collection",
        "Shared value objects (CustomerId, Money)",
        "All in sharedkernel package"
      ],
      "passes": true
    },
    {
      "id": "US-6",
      "title": "Domain-Centric Architecture Refactoring",
      "description": "Refactor package structure to follow domain-centric architecture with clear layer separation.",
      "acceptance_criteria": [
        "Package structure: domain, application, adapter, infrastructure",
        "Adapters split into incoming (controllers) and outgoing (repositories)",
        "Spring application class in infrastructure layer",
        "Naming conventions documented and applied",
        "Event listeners moved to adapter layer"
      ],
      "passes": true
    },
    {
      "id": "US-7",
      "title": "Shopping Cart Bounded Context",
      "description": "Implement Shopping Cart bounded context with cart aggregate and add-to-cart functionality.",
      "acceptance_criteria": [
        "ShoppingCart aggregate with CartId, CustomerId, line items",
        "CartLineItem entity with product reference and quantity",
        "AddToCartUseCase for adding products",
        "CartRepository interface and implementation",
        "CartPageController for viewing cart",
        "Cart view template"
      ],
      "passes": true
    },
    {
      "id": "US-8",
      "title": "Cross-Context Integration Events",
      "description": "Implement event-driven communication between bounded contexts using domain and integration events.",
      "acceptance_criteria": [
        "DomainEvent interface for internal events",
        "IntegrationEvent for cross-context communication",
        "Event publishing infrastructure with Spring events",
        "Event consumers in adapter.incoming.event package",
        "ProductAddedToCart example integration"
      ],
      "passes": true
    },
    {
      "id": "US-9",
      "title": "In-Memory Repository Implementation",
      "description": "Implement thread-safe in-memory repositories using ConcurrentHashMap for development and testing.",
      "acceptance_criteria": [
        "ConcurrentHashMap-based storage",
        "Thread-safe operations",
        "Secondary indexes for efficient lookups",
        "InMemoryProductRepository implementation",
        "InMemoryCartRepository implementation"
      ],
      "passes": true
    },
    {
      "id": "US-10",
      "title": "Specification Pattern",
      "description": "Implement Specification pattern for encapsulating business rules and query criteria.",
      "acceptance_criteria": [
        "Specification<T> interface with isSatisfiedBy method",
        "Composite specifications (and, or, not)",
        "Example specification implementations",
        "Repository support for specification queries"
      ],
      "passes": true
    },
    {
      "id": "US-11",
      "renamed_from": "US-1",
      "title": "Domain Value Objects",
      "description": "Create checkout domain value objects (CheckoutSessionId, CheckoutStep, BuyerInfo, DeliveryAddress, ShippingOption, PaymentProviderId, PaymentSelection, CheckoutTotals, CheckoutLineItem)",
      "acceptance_criteria": [
        "CheckoutSessionId value object with generate() and of() methods",
        "CheckoutStep enum with all states",
        "BuyerInfo, DeliveryAddress, ShippingOption value objects",
        "PaymentProviderId, PaymentSelection value objects",
        "CheckoutTotals, CheckoutLineItemId, CheckoutLineItem value objects",
        "All implement Value interface with proper validation"
      ],
      "passes": true
    },
    {
      "id": "US-12",
      "renamed_from": "US-2",
      "title": "CheckoutSession Aggregate",
      "description": "Create CheckoutSession aggregate root with state management and invariants",
      "acceptance_criteria": [
        "Extends AggregateRoot<CheckoutSession, CheckoutSessionId>",
        "Factory method: start(cartId, customerId, lineItems, subtotal)",
        "Methods: submitBuyerInfo(), submitDelivery(), submitPayment(), confirm(), complete(), abandon(), expire()",
        "Step validation: cannot skip steps, can go back",
        "Raises domain events for each step"
      ],
      "passes": true
    },
    {
      "id": "US-13",
      "renamed_from": "US-3",
      "title": "Domain Events",
      "description": "Create checkout domain events for state changes",
      "acceptance_criteria": [
        "CheckoutStarted event",
        "BuyerInfoSubmitted event",
        "DeliverySubmitted event",
        "PaymentSubmitted event",
        "CheckoutConfirmed integration event"
      ],
      "passes": true
    },
    {
      "id": "US-14",
      "renamed_from": "US-4",
      "title": "Repository and Persistence",
      "description": "Create checkout session repository interface and in-memory implementation",
      "acceptance_criteria": [
        "CheckoutSessionRepository interface in application/shared",
        "Methods: save(), findById(), findByCartId(), findExpiredSessions()",
        "InMemoryCheckoutSessionRepository implementation"
      ],
      "passes": true
    },
    {
      "id": "US-15",
      "renamed_from": "US-5",
      "title": "Start Checkout Use Case",
      "description": "Use case to begin checkout process from cart",
      "acceptance_criteria": [
        "StartCheckoutInputPort extends UseCase",
        "StartCheckoutCommand and StartCheckoutResponse",
        "StartCheckoutUseCase implementation",
        "Loads cart, creates session, saves session"
      ],
      "passes": true
    },
    {
      "id": "US-16",
      "renamed_from": "US-6",
      "title": "Submit Buyer Info Use Case",
      "description": "Use case for customer contact information",
      "acceptance_criteria": [
        "SubmitBuyerInfoInputPort extends UseCase",
        "SubmitBuyerInfoCommand and SubmitBuyerInfoResponse",
        "Validates session and step",
        "Updates session with buyer info"
      ],
      "passes": true
    },
    {
      "id": "US-17",
      "renamed_from": "US-7",
      "title": "Submit Delivery Use Case",
      "description": "Use case for delivery address and shipping option",
      "acceptance_criteria": [
        "SubmitDeliveryInputPort extends UseCase",
        "SubmitDeliveryCommand and SubmitDeliveryResponse",
        "Validates session and step",
        "Updates session with delivery info"
      ],
      "passes": true
    },
    {
      "id": "US-18",
      "renamed_from": "US-8",
      "title": "Get Shipping Options Use Case",
      "description": "Use case to retrieve available shipping methods",
      "acceptance_criteria": [
        "GetShippingOptionsInputPort extends UseCase",
        "GetShippingOptionsQuery and GetShippingOptionsResponse",
        "Returns hardcoded shipping options"
      ],
      "passes": true
    },
    {
      "id": "US-19",
      "renamed_from": "US-9",
      "title": "Payment Provider System",
      "description": "Plugin architecture for payment providers",
      "acceptance_criteria": [
        "PaymentProvider output port interface",
        "PaymentProviderRegistry output port interface",
        "MockPaymentProvider adapter",
        "InMemoryPaymentProviderRegistry adapter"
      ],
      "passes": true
    },
    {
      "id": "US-20",
      "renamed_from": "US-10",
      "title": "Submit Payment Use Case",
      "description": "Use case for payment selection and authorization",
      "acceptance_criteria": [
        "SubmitPaymentInputPort extends UseCase",
        "SubmitPaymentCommand and SubmitPaymentResponse",
        "Validates provider exists",
        "Updates session with payment"
      ],
      "passes": true
    },
    {
      "id": "US-21",
      "renamed_from": "US-11",
      "title": "Get Payment Providers Use Case",
      "description": "Use case to retrieve available payment methods",
      "acceptance_criteria": [
        "GetPaymentProvidersInputPort extends UseCase",
        "GetPaymentProvidersQuery and GetPaymentProvidersResponse",
        "Uses PaymentProviderRegistry"
      ],
      "passes": true
    },
    {
      "id": "US-22",
      "renamed_from": "US-12",
      "title": "Get Checkout Session Use Case",
      "description": "Use case to load session data for display",
      "acceptance_criteria": [
        "GetCheckoutSessionInputPort extends UseCase",
        "GetCheckoutSessionQuery and GetCheckoutSessionResponse",
        "Returns all session data or found=false"
      ],
      "passes": true
    },
    {
      "id": "US-23",
      "renamed_from": "US-13",
      "title": "Confirm Checkout Use Case",
      "description": "Use case to complete the order",
      "acceptance_criteria": [
        "ConfirmCheckoutInputPort extends UseCase",
        "ConfirmCheckoutCommand and ConfirmCheckoutResponse",
        "Validates all required info",
        "Publishes CheckoutConfirmed event"
      ],
      "passes": true
    },
    {
      "id": "US-24",
      "renamed_from": "US-14",
      "title": "Checkout Step Validator",
      "description": "Component to enforce step navigation rules",
      "acceptance_criteria": [
        "CheckoutStepValidator component",
        "validateStepAccess returns redirect URL or empty",
        "Handles invalid session, skip ahead, go back, terminal states"
      ],
      "passes": true
    },
    {
      "id": "US-25",
      "renamed_from": "US-15",
      "title": "Start Checkout Controller",
      "description": "Controller to initiate checkout from cart",
      "acceptance_criteria": [
        "StartCheckoutPageController at /checkout/start",
        "GET with cartId parameter",
        "Redirects to /checkout/{id}/buyer"
      ],
      "passes": true
    },
    {
      "id": "US-26",
      "renamed_from": "US-16",
      "title": "Buyer Info Controller",
      "description": "Controller for contact information page",
      "acceptance_criteria": [
        "BuyerInfoPageController at /checkout/{id}/buyer",
        "GET returns buyer.pug template",
        "POST redirects to delivery"
      ],
      "passes": true
    },
    {
      "id": "US-27",
      "renamed_from": "US-17",
      "title": "Delivery Controller",
      "description": "Controller for shipping address page",
      "acceptance_criteria": [
        "DeliveryPageController at /checkout/{id}/delivery",
        "GET returns delivery.pug template",
        "POST redirects to payment"
      ],
      "passes": true
    },
    {
      "id": "US-28",
      "renamed_from": "US-18",
      "title": "Payment Controller",
      "description": "Controller for payment method page",
      "acceptance_criteria": [
        "PaymentPageController at /checkout/{id}/payment",
        "GET returns payment.pug template",
        "POST redirects to review"
      ],
      "passes": true
    },
    {
      "id": "US-29",
      "renamed_from": "US-19",
      "title": "Review Controller",
      "description": "Controller for order review page",
      "acceptance_criteria": [
        "ReviewPageController at /checkout/{id}/review",
        "GET returns review.pug with all order details",
        "Edit links to previous steps"
      ],
      "passes": true
    },
    {
      "id": "US-30",
      "renamed_from": "US-20",
      "title": "Confirmation Controller",
      "description": "Controller for order confirmation",
      "acceptance_criteria": [
        "POST /checkout/{id}/confirm calls ConfirmCheckoutUseCase",
        "GET /checkout/{id}/confirmation shows thank you page",
        "Only accessible after confirmation"
      ],
      "passes": true
    },
    {
      "id": "US-31",
      "renamed_from": "US-21",
      "title": "Checkout Templates",
      "description": "Pug templates for checkout pages",
      "acceptance_criteria": [
        "buyer.pug, delivery.pug, payment.pug templates",
        "review.pug with order summary",
        "confirmation.pug thank you page",
        "All extend layout with step progress"
      ],
      "passes": true
    },
    {
      "id": "US-32",
      "renamed_from": "US-22",
      "title": "Cart Integration",
      "description": "Integrate checkout with cart context",
      "acceptance_criteria": [
        "Checkout button on cart page",
        "CheckoutEventConsumer listens for CheckoutConfirmed",
        "Calls CheckoutCartUseCase to update cart status"
      ],
      "passes": true
    },
    {
      "id": "US-33",
      "renamed_from": "US-23",
      "title": "Architecture Tests Pass",
      "description": "Verify checkout follows project patterns",
      "acceptance_criteria": [
        "./gradlew test-architecture passes",
        "No direct imports from Cart domain",
        "Domain layer has no Spring annotations",
        "All use cases follow InputPort pattern"
      ],
      "passes": true
    },
    {
      "id": "US-34",
      "renamed_from": "US-24",
      "title": "Build and Manual Test",
      "description": "Verify complete checkout flow works end-to-end",
      "acceptance_criteria": [
        "./gradlew build passes",
        "Application starts successfully",
        "Complete flow: Buyer → Delivery → Payment → Review → Confirm",
        "Cart status is CHECKED_OUT after completion"
      ],
      "passes": true
    },
    {
      "id": "US-35",
      "renamed_from": "US-25",
      "title": "Connect Cart Checkout Button to Checkout Flow",
      "description": "Replace the fake checkout button on the cart page with a link to the new checkout bounded context. The cart page should redirect to the checkout flow instead of the old fake checkout endpoint.",
      "acceptance_criteria": [
        "Cart page checkout button redirects to /checkout/start?cartId={cartId} instead of /cart/{cartId}/checkout",
        "Old /cart/{cartId}/checkout endpoint is removed or deprecated",
        "Checkout flow can be started from the cart page",
        "Architecture tests pass"
      ],
      "passes": true
    },
    {
      "id": "US-36",
      "renamed_from": "US-26",
      "title": "Reduce Product Availability on Checkout",
      "description": "When a checkout is confirmed, the product availability must be reduced by the quantities purchased. The product context listens for the CheckoutConfirmed integration event and reduces availability for each line item.",
      "acceptance_criteria": [
        "Product context has a CheckoutConfirmedEventListener that listens for CheckoutConfirmed events",
        "For each line item in the checkout, product availability is reduced by the purchased quantity",
        "Uses existing Product aggregate's reduceAvailability() method",
        "Architecture tests pass (no direct coupling between Checkout and Product domains)"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "adapter"
        ],
        "locations": [
          "product.adapter.incoming.event.CheckoutConfirmedEventListener"
        ],
        "patterns": [
          "Event Consumer",
          "Cross-Context Integration"
        ],
        "constraints": [
          "Event listener in product.adapter.incoming.event package",
          "No direct imports from checkout.domain - only checkout integration events",
          "Call ProductRepository via application layer or directly (simple case)",
          "Use @EventListener or @TransactionalEventListener(phase = AFTER_COMMIT)",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": true
    },
    {
      "id": "US-37",
      "renamed_from": "US-27",
      "title": "Remove Deprecated CartCheckedOut Availability Logic",
      "description": "The CartCheckedOut event was previously used to reduce product availability. Since US-36 now handles this via CheckoutConfirmed event, the old CartCheckedOut event consumer and related logic in the product context should be removed.",
      "acceptance_criteria": [
        "CartCheckedOutEventListener in product context is removed (if exists)",
        "Any CartCheckedOut event handling for availability reduction is removed",
        "CartCheckedOut event itself remains if still used for cart status updates",
        "Build and architecture tests pass",
        "Product availability is only reduced via CheckoutConfirmed (US-36)"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "adapter"
        ],
        "locations": [
          "product.adapter.incoming.event.CartCheckedOutEventListener (DELETE)"
        ],
        "patterns": [
          "Code Removal",
          "Dead Code Cleanup"
        ],
        "constraints": [
          "Search for CartCheckedOut references in product context",
          "Verify event is not used elsewhere before removing listener",
          "Keep CartCheckedOut event if cart context still publishes it for other purposes",
          "Run ./gradlew test-architecture after removal",
          "Run ./gradlew build to ensure no compilation errors"
        ]
      },
      "passes": true
    },
    {
      "id": "US-38",
      "renamed_from": "US-28",
      "title": "Handle Missing Account After Application Restart",
      "description": "After application restart with in-memory storage, JWT tokens remain valid but accounts are lost. Registered users should be treated as anonymous when their account no longer exists.",
      "acceptance_criteria": [
        "RegisteredUserValidator port interface in sharedkernel/application/port/security",
        "AccountBasedRegisteredUserValidator implementation in account/adapter/outgoing/security",
        "JwtAuthenticationFilter checks if registered user's account exists",
        "If account doesn't exist, creates new anonymous identity and token",
        "User sees logged-out state and can register/login again",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "sharedkernel",
          "adapter",
          "infrastructure"
        ],
        "locations": [
          "sharedkernel.application.port.security.RegisteredUserValidator",
          "account.adapter.outgoing.security.AccountBasedRegisteredUserValidator",
          "infrastructure.security.jwt.JwtAuthenticationFilter"
        ],
        "patterns": [
          "Port/Adapter",
          "Cross-Context Integration via Shared Kernel"
        ],
        "constraints": [
          "Port interface in shared kernel maintains bounded context isolation",
          "Infrastructure depends on port, not account context directly",
          "Account context provides implementation"
        ]
      },
      "passes": true
    },
    {
      "id": "US-39",
      "renamed_from": "US-29",
      "title": "E2E Test Infrastructure with Playwright",
      "description": "Set up end-to-end testing infrastructure using Playwright for Java to test critical user flows through the browser.",
      "acceptance_criteria": [
        "Playwright Java dependency added to build.gradle",
        "test-e2e source set configured separately from unit tests",
        "BaseE2ETest class with Playwright setup/teardown",
        "IntelliJ run configurations for E2E tests (headless and headed)",
        "E2E tests can be run via ./gradlew test-e2e"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "test-e2e"
        ],
        "locations": [
          "src/test-e2e/java/de/sample/aiarchitecture/e2e/BaseE2ETest.java"
        ],
        "patterns": [
          "Test Infrastructure",
          "Browser Automation"
        ]
      },
      "passes": true
    },
    {
      "id": "US-40",
      "renamed_from": "US-30",
      "title": "Data-Test Attributes for E2E Testing",
      "description": "Add data-test attributes to UI elements to provide stable selectors for E2E tests, decoupling tests from CSS classes and DOM structure.",
      "acceptance_criteria": [
        "data-test attributes added to interactive elements (buttons, links, forms)",
        "data-test attributes added to key display elements (prices, totals, messages)",
        "Naming convention: kebab-case descriptive names (e.g., data-test=\"checkout-button\")",
        "ADR documenting the data-test attribute strategy",
        "Templates updated: login, register, cart, catalog, product detail, checkout pages"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "adapter"
        ],
        "locations": [
          "src/main/resources/templates/**/*.pug",
          "docs/architecture/adr/adr-017-e2e-data-test-attributes.md"
        ],
        "patterns": [
          "Test Attribute Strategy",
          "Stable Selectors"
        ],
        "constraints": [
          "Never use data-test attributes for styling",
          "data-test attributes are for testing infrastructure only",
          "Keep attribute names semantic and descriptive"
        ]
      },
      "passes": true
    },
    {
      "id": "US-41",
      "renamed_from": "US-31",
      "title": "Page Object Pattern for E2E Tests",
      "description": "Implement Page Object pattern to encapsulate page interactions and selectors, improving test maintainability and readability.",
      "acceptance_criteria": [
        "Page object classes for each major page (LoginPage, RegisterPage, CartPage, etc.)",
        "Page objects use data-test attributes for element selection",
        "Page objects provide high-level methods for user actions",
        "ADR documenting the Page Object pattern",
        "E2E tests refactored to use page objects"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "test-e2e"
        ],
        "locations": [
          "src/test-e2e/java/de/sample/aiarchitecture/e2e/pages/",
          "docs/architecture/adr/adr-018-page-object-pattern-e2e.md"
        ],
        "patterns": [
          "Page Object Pattern",
          "Test Abstraction"
        ],
        "constraints": [
          "Page objects should not contain assertions",
          "Page objects return page objects for fluent navigation",
          "Selectors centralized in page objects, not in tests"
        ]
      },
      "passes": true
    },
    {
      "id": "US-42",
      "renamed_from": "US-32",
      "title": "JWT Authentication Infrastructure",
      "description": "Implement JWT-based authentication infrastructure with anonymous and registered user support. Anonymous users get a soft identity via JWT cookie, which converts to a hard identity on registration/login.",
      "acceptance_criteria": [
        "JwtTokenService for generating and validating JWT tokens",
        "JwtAuthenticationFilter extracts identity from cookie or creates anonymous identity",
        "Identity record with userId, type (ANONYMOUS/REGISTERED), email, and roles",
        "IdentityProvider port for accessing current identity in use cases",
        "TokenService port interface in shared kernel",
        "JWT cookie with HttpOnly, SameSite=Lax settings",
        "Anonymous tokens valid 30 days, registered tokens valid 7 days"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "sharedkernel",
          "infrastructure"
        ],
        "locations": [
          "sharedkernel.application.port.security.TokenService",
          "sharedkernel.application.port.security.IdentityProvider",
          "sharedkernel.application.common.security.Identity",
          "infrastructure.security.jwt.JwtTokenService",
          "infrastructure.security.jwt.JwtAuthenticationFilter",
          "infrastructure.security.SpringSecurityIdentityProvider"
        ],
        "patterns": [
          "Port/Adapter",
          "Security Filter Chain"
        ]
      },
      "passes": true
    },
    {
      "id": "US-43",
      "renamed_from": "US-33",
      "title": "Account Bounded Context with Registration and Login",
      "description": "Create Account bounded context with user registration and authentication capabilities. Accounts are linked to UserId for cart continuity.",
      "acceptance_criteria": [
        "Account aggregate with AccountId, Email, HashedPassword, linkedUserId",
        "RegisterAccountUseCase for new user registration",
        "AuthenticateAccountUseCase for login validation",
        "AccountRepository interface and InMemoryAccountRepository",
        "PasswordHasher port with BCrypt implementation",
        "AuthResource REST controller for API authentication",
        "LoginPageController and RegisterPageController for web UI",
        "Login and register Pug templates"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain",
          "application",
          "adapter"
        ],
        "locations": [
          "account.domain.model.Account",
          "account.application.registeraccount.RegisterAccountUseCase",
          "account.application.authenticateaccount.AuthenticateAccountUseCase",
          "account.adapter.incoming.api.AuthResource",
          "account.adapter.incoming.web.LoginPageController",
          "account.adapter.incoming.web.RegisterPageController"
        ],
        "patterns": [
          "Aggregate",
          "Use Case Pattern",
          "Port/Adapter"
        ]
      },
      "passes": true
    },
    {
      "id": "US-44",
      "renamed_from": "US-34",
      "title": "Migrate Controllers to JWT Identity",
      "description": "Migrate Cart and Checkout controllers from session-based customer ID to JWT-based identity. Controllers use IdentityProvider to get current user instead of URL parameters.",
      "acceptance_criteria": [
        "CartPageController uses IdentityProvider.getCurrentIdentity()",
        "All Checkout controllers use IdentityProvider for user identification",
        "Session IDs removed from checkout URLs (use /checkout/{sessionId}/step pattern)",
        "CustomerId derived from Identity.userId()",
        "Cart is automatically associated with current identity"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "adapter"
        ],
        "locations": [
          "cart.adapter.incoming.web.CartPageController",
          "checkout.adapter.incoming.web.*PageController"
        ],
        "patterns": [
          "Identity Provider",
          "Security Context"
        ]
      },
      "passes": true
    },
    {
      "id": "US-45",
      "renamed_from": "US-35",
      "title": "Recover Cart on Login",
      "description": "When an anonymous user logs in, their cart should be recovered and associated with their registered account. The cart created during anonymous browsing persists after login.",
      "acceptance_criteria": [
        "RecoverCartOnLoginUseCase transfers cart ownership on login",
        "Anonymous user's cart items preserved after registration/login",
        "Cart associated with registered user's linkedUserId",
        "Login flow triggers cart recovery automatically"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "application"
        ],
        "locations": [
          "cart.application.recovercart.RecoverCartOnLoginUseCase"
        ],
        "patterns": [
          "Use Case Pattern",
          "Identity Continuity"
        ]
      },
      "passes": true
    },
    {
      "id": "US-46",
      "renamed_from": "US-36",
      "title": "Checkout Login/Register Options on Buyer Page",
      "description": "Add login and register options to the checkout buyer info page, allowing anonymous users to create an account or login during checkout.",
      "acceptance_criteria": [
        "Buyer page shows login/register options for anonymous users",
        "Login redirects back to checkout after authentication",
        "Register redirects back to checkout after account creation",
        "Registered users see their email pre-filled",
        "Guest checkout still available without account"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "adapter"
        ],
        "locations": [
          "checkout.adapter.incoming.web.BuyerInfoPageController",
          "templates/checkout/buyer.pug"
        ],
        "patterns": [
          "Progressive Authentication"
        ]
      },
      "passes": true
    },
    {
      "id": "US-47",
      "title": "Preserve Cart and Checkout Session on Registration",
      "description": "When registering during checkout, the cart and checkout session should be preserved. Fix by removing the 'anon-' prefix from anonymous tokens so UserId doesn't change on registration.",
      "acceptance_criteria": [
        "Anonymous tokens use raw UUID without 'anon-' prefix",
        "UserId remains unchanged after registration",
        "Cart items preserved after registration during checkout",
        "Checkout session preserved after registration during checkout",
        "User returns to checkout flow after registration without losing progress",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "infrastructure",
          "domain",
          "sharedkernel"
        ],
        "locations": [
          "infrastructure.security.jwt.JwtTokenService",
          "sharedkernel.domain.common.UserId",
          "account.domain.model.Account"
        ],
        "patterns": [
          "Identity Continuity"
        ],
        "constraints": [
          "Anonymous tokens must use raw UUID format (no prefix)",
          "UserId must be identical before and after registration",
          "Update UserId.isAnonymous() to use IdentityType from JWT instead of prefix",
          "Remove UserId transformation in Account.register()",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": true
    },
    {
      "id": "US-48",
      "title": "Cart Merge Options on Login During Checkout",
      "description": "When an anonymous user with items in their anonymous cart logs in and their account already has a cart with items, present them with a choice: (1) Merge both carts, (2) Use account cart only, or (3) Use anonymous cart only. Execute the selected choice.",
      "acceptance_criteria": [
        "Detect if both anonymous cart and account cart have items during login",
        "Display merge options UI only when both carts have items",
        "Option 1: Merge - combine items from both carts (add quantities for same products)",
        "Option 2: Use account cart - discard anonymous cart, keep account cart",
        "Option 3: Use anonymous cart - replace account cart with anonymous cart items",
        "After merge/use account: delete anonymous cart",
        "After use anonymous: keep anonymous cart (becomes the account cart)",
        "User returns to checkout flow after selection",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain",
          "application",
          "adapter"
        ],
        "locations": [
          "cart.domain.model.ShoppingCart (merge method)",
          "cart.application.mergecarts/MergeCartsUseCase",
          "cart.application.mergecarts/MergeCartsInputPort",
          "cart.application.mergecarts/MergeCartsCommand",
          "cart.application.mergecarts/MergeCartsResponse",
          "cart.application.getcartmergeoptions/GetCartMergeOptionsUseCase",
          "cart.adapter.incoming.web.CartMergePageController",
          "account.adapter.incoming.web.LoginPageController (redirect logic)",
          "templates/cart/merge-options.pug"
        ],
        "patterns": [
          "Use Case Pattern",
          "Domain Logic in Aggregate",
          "Progressive Authentication"
        ],
        "constraints": [
          "Merge logic belongs in ShoppingCart aggregate",
          "Use case orchestrates loading both carts and calling merge",
          "No direct cart manipulation in controllers",
          "Controller redirects to merge page when conflict detected",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": true
    },
    {
      "id": "US-49",
      "title": "Cart Merge Test Coverage",
      "description": "Implement comprehensive test coverage for cart merge functionality using a layered testing approach: unit tests for domain logic, integration tests for use case orchestration, and one E2E test for the full flow.",
      "acceptance_criteria": [
        "Unit tests for ShoppingCart.merge() covering: same product quantity combination, different products addition, empty cart handling",
        "Integration tests for MergeCartsUseCase covering all 3 strategies: merge, use-account, use-anonymous",
        "Integration tests verify correct cart deletion based on strategy",
        "One E2E test verifying the full flow: login with both carts having items, see merge options, select merge, verify combined cart",
        "All tests pass: ./gradlew test, ./gradlew test-e2e"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain",
          "application",
          "test-e2e"
        ],
        "locations": [
          "src/test/java/de/sample/aiarchitecture/cart/domain/model/ShoppingCartTest.java",
          "src/test/java/de/sample/aiarchitecture/cart/application/mergecarts/MergeCartsUseCaseTest.java",
          "src/test-e2e/java/de/sample/aiarchitecture/e2e/CartMergeE2ETest.java",
          "src/test-e2e/java/de/sample/aiarchitecture/e2e/pages/CartMergePage.java"
        ],
        "patterns": [
          "Layered Testing",
          "Page Object Pattern",
          "Unit Test Isolation"
        ],
        "constraints": [
          "Unit tests must not depend on Spring context",
          "Integration tests use @SpringBootTest with test slices where appropriate",
          "E2E test uses Page Object pattern for CartMergePage",
          "E2E test covers only one happy path scenario (merge strategy)",
          "Edge cases and error scenarios covered by unit/integration tests"
        ]
      },
      "passes": true
    },
    {
      "id": "US-50",
      "title": "Fix Incoming Adapter Cross-Context Violations",
      "description": "Fix architectural violations where incoming adapters access other bounded contexts directly. StartCheckoutPageController should not call cart use cases, and LoginPageController should not call cart use cases. Enforce bounded context isolation at the adapter layer.",
      "acceptance_criteria": [
        "StartCheckoutPageController accepts cartId as URL parameter instead of calling GetOrCreateActiveCartUseCase",
        "LoginPageController redirects to /cart/merge with URL parameters instead of calling GetCartMergeOptionsUseCase",
        "CartMergePageController accepts anonymousUserId and returnUrl from URL parameters (stateless, no session)",
        "No imports from cart context in checkout adapters",
        "No imports from cart context in account adapters",
        "Architecture tests pass: ./gradlew test-architecture",
        "All tests pass: ./gradlew test"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "adapter"
        ],
        "locations": [
          "checkout.adapter.incoming.web.StartCheckoutPageController",
          "account.adapter.incoming.web.LoginPageController",
          "cart.adapter.incoming.web.CartMergePageController",
          "templates/cart/merge-options.pug"
        ],
        "patterns": [
          "Bounded Context Isolation",
          "URL Parameter State Transfer",
          "Stateless Controllers"
        ],
        "constraints": [
          "Incoming adapters must only access their own bounded context's use cases",
          "Cross-context coordination happens via URL redirects with parameters",
          "No session storage - use URL parameters for state transfer",
          "Cart context decides if merge is needed (not account context)",
          "UI passes known data (cartId) instead of controller querying other contexts",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": true
    },
    {
      "id": "US-51",
      "title": "Bounded Context Isolation via Open Host Service Pattern",
      "description": "Eliminate cross-context imports in application layer by introducing ProductCatalogService as an Open Host Service in Product context. Cart and Checkout define their own output ports (ProductDataPort, ProductInfoPort) with outgoing adapters that call the OHS. This ensures use cases never import from other bounded contexts.",
      "acceptance_criteria": [
        "OpenHostService annotation created in sharedkernel/stereotype",
        "ProductCatalogService created in product/adapter/incoming/openhost with @OpenHostService annotation",
        "ProductDataPort created in cart/application/shared as Cart's output port for product data",
        "ProductDataAdapter created in cart/adapter/outgoing/product implementing ProductDataPort",
        "AddItemToCartUseCase uses ProductDataPort instead of ProductRepository from Product context",
        "ProductInfoPort created in checkout/application/shared as Checkout's output port for product names",
        "ProductInfoAdapter created in checkout/adapter/outgoing/product implementing ProductInfoPort",
        "StartCheckoutUseCase and SyncCheckoutWithCartUseCase use ProductInfoPort instead of ProductRepository",
        "ArchUnit test updated: application layer has no cross-context imports except documented exceptions",
        "ArchUnit test added: outgoing adapters may only access @OpenHostService from other contexts",
        "All tests pass: ./gradlew test-architecture, ./gradlew build"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "sharedkernel",
          "application",
          "adapter"
        ],
        "locations": [
          "sharedkernel.stereotype.OpenHostService",
          "product.adapter.incoming.openhost.ProductCatalogService",
          "cart.application.shared.ProductDataPort",
          "cart.adapter.outgoing.product.ProductDataAdapter",
          "cart.application.additemtocart.AddItemToCartUseCase",
          "checkout.application.shared.ProductInfoPort",
          "checkout.adapter.outgoing.product.ProductInfoAdapter",
          "checkout.application.startcheckout.StartCheckoutUseCase",
          "checkout.application.synccheckoutwithcart.SyncCheckoutWithCartUseCase",
          "DddStrategicPatternsArchUnitTest.groovy",
          "HexagonalArchitectureArchUnitTest.groovy"
        ],
        "patterns": [
          "Open Host Service",
          "Output Port",
          "Adapter Pattern",
          "Bounded Context Isolation"
        ],
        "constraints": [
          "Use cases must NEVER import from other bounded contexts directly",
          "Cross-context access is isolated to outgoing adapters",
          "Outgoing adapters may only import @OpenHostService classes from other contexts",
          "Open Host Services return DTOs, never domain objects",
          "Each context owns its output port definitions",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": true
    },
    {
      "id": "US-52",
      "epic": "pricing-context",
      "title": "Pricing Domain Value Objects",
      "description": "Create pricing domain value objects (PriceId) for the new Pricing bounded context.",
      "depends_on": [],
      "acceptance_criteria": [
        "PriceId value object with generate() and of() methods",
        "Implements Value interface with proper validation",
        "All in pricing/domain/model/ package"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["pricing.domain.model.PriceId"],
        "patterns": ["Value Object as Java record"]
      },
      "passes": false
    },
    {
      "id": "US-53",
      "epic": "pricing-context",
      "title": "ProductPrice Aggregate",
      "description": "Create ProductPrice aggregate root for managing product prices with proper invariants.",
      "depends_on": ["US-52"],
      "acceptance_criteria": [
        "Extends BaseAggregateRoot<ProductPrice, PriceId>",
        "Fields: id, productId, currentPrice (Money), effectiveFrom (Instant)",
        "Factory method: create(productId, price)",
        "Method: updatePrice(newPrice) raises PriceChanged event",
        "Validates price > 0"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["pricing.domain.model.ProductPrice"],
        "patterns": ["Aggregate Root"]
      },
      "passes": false
    },
    {
      "id": "US-54",
      "epic": "pricing-context",
      "title": "Pricing Domain Events",
      "description": "Create pricing domain events for price changes.",
      "depends_on": ["US-53"],
      "acceptance_criteria": [
        "PriceCreated event (priceId, productId, price, effectiveFrom)",
        "PriceChanged event (priceId, productId, oldPrice, newPrice, effectiveFrom)",
        "All implement DomainEvent interface with eventId, occurredOn, version"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["pricing.domain.event.PriceCreated", "pricing.domain.event.PriceChanged"],
        "patterns": ["Domain Event as immutable record"]
      },
      "passes": false
    },
    {
      "id": "US-55",
      "epic": "pricing-context",
      "title": "ProductPriceRepository Interface",
      "description": "Create repository interface for persisting and retrieving product prices.",
      "depends_on": ["US-53"],
      "acceptance_criteria": [
        "Extends Repository<ProductPrice, PriceId>",
        "Methods: findByProductId(ProductId), findByProductIds(Collection<ProductId>)",
        "Interface in application/shared"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["pricing.application.shared.ProductPriceRepository"],
        "patterns": ["Repository Interface"]
      },
      "passes": false
    },
    {
      "id": "US-56",
      "epic": "pricing-context",
      "title": "InMemoryProductPriceRepository",
      "description": "Implement in-memory repository for pricing context.",
      "depends_on": ["US-55"],
      "acceptance_criteria": [
        "Implements ProductPriceRepository",
        "ConcurrentHashMap-based storage",
        "Secondary index on ProductId for efficient lookups",
        "Thread-safe operations"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["pricing.adapter.outgoing.persistence.InMemoryProductPriceRepository"],
        "patterns": ["In-Memory Repository"]
      },
      "passes": false
    },
    {
      "id": "US-57",
      "epic": "pricing-context",
      "title": "GetPricesForProducts Use Case",
      "description": "Create bulk price lookup use case for Cart/Checkout to fetch prices efficiently.",
      "depends_on": ["US-55"],
      "acceptance_criteria": [
        "GetPricesForProductsInputPort extends UseCase",
        "GetPricesForProductsQuery(Collection<ProductId> productIds)",
        "GetPricesForProductsResult with Map<ProductId, PriceData>",
        "PriceData record: productId, currentPrice, effectiveFrom"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["pricing.application.getpricesforproducts"],
        "patterns": ["Use Case with Query/Result"]
      },
      "passes": false
    },
    {
      "id": "US-58",
      "epic": "pricing-context",
      "title": "PricingService Open Host Service",
      "description": "Create PricingService OHS for other contexts to access pricing through a stable API.",
      "depends_on": ["US-57"],
      "acceptance_criteria": [
        "@OpenHostService annotation",
        "record PriceInfo(ProductId, Money currentPrice, Instant effectiveFrom)",
        "getPrices(Collection<ProductId>) returns Map<ProductId, PriceInfo>",
        "getPrice(ProductId) returns Optional<PriceInfo>",
        "Delegates to GetPricesForProductsUseCase"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["pricing.adapter.incoming.openhost.PricingService"],
        "patterns": ["Open Host Service"]
      },
      "passes": false
    },
    {
      "id": "US-59",
      "epic": "pricing-context",
      "title": "SetProductPrice Use Case",
      "description": "Create use case to set/update product prices.",
      "depends_on": ["US-55", "US-54"],
      "acceptance_criteria": [
        "SetProductPriceInputPort extends UseCase",
        "SetProductPriceCommand(productId, priceAmount, priceCurrency)",
        "Creates new ProductPrice if not exists, updates if exists",
        "Publishes domain events"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["pricing.application.setproductprice"],
        "patterns": ["Use Case with Command/Result"]
      },
      "passes": false
    },
    {
      "id": "US-60",
      "epic": "pricing-context",
      "title": "Pricing Context ArchUnit Rules",
      "description": "Verify architecture tests cover new pricing context.",
      "depends_on": ["US-58", "US-59"],
      "acceptance_criteria": [
        "Domain has no Spring annotations",
        "Repository interface in application/shared",
        "OHS in adapter/incoming/openhost",
        "All ArchUnit tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": ["test-architecture"],
        "locations": ["Existing ArchUnit tests"],
        "patterns": ["Architecture Testing"]
      },
      "passes": false
    },
    {
      "id": "US-61",
      "epic": "inventory-context",
      "title": "Inventory Domain Value Objects",
      "description": "Create inventory domain value objects for the new Inventory bounded context.",
      "depends_on": [],
      "acceptance_criteria": [
        "StockLevelId value object with generate() and of()",
        "StockQuantity value object (int value, cannot be negative)",
        "Implements Value interface"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["inventory.domain.model.StockLevelId", "inventory.domain.model.StockQuantity"],
        "patterns": ["Value Object as Java record"]
      },
      "passes": false
    },
    {
      "id": "US-62",
      "epic": "inventory-context",
      "title": "StockLevel Aggregate",
      "description": "Create StockLevel aggregate root for managing product inventory with proper invariants.",
      "depends_on": ["US-61"],
      "acceptance_criteria": [
        "Extends BaseAggregateRoot<StockLevel, StockLevelId>",
        "Fields: id, productId, availableQuantity (StockQuantity), reservedQuantity",
        "Factory method: create(productId, initialQuantity)",
        "Methods: increaseStock(int), decreaseStock(int), reserve(int), release(int)",
        "isAvailable() returns availableQuantity > reservedQuantity",
        "Raises StockChanged events"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["inventory.domain.model.StockLevel"],
        "patterns": ["Aggregate Root"]
      },
      "passes": false
    },
    {
      "id": "US-63",
      "epic": "inventory-context",
      "title": "Inventory Domain Events",
      "description": "Create inventory domain events for stock changes.",
      "depends_on": ["US-62"],
      "acceptance_criteria": [
        "StockLevelCreated event (stockLevelId, productId, quantity)",
        "StockIncreased event (stockLevelId, productId, addedQuantity, newQuantity)",
        "StockDecreased event (stockLevelId, productId, removedQuantity, newQuantity)",
        "StockReserved event (stockLevelId, productId, reservedQuantity)"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["inventory.domain.event"],
        "patterns": ["Domain Event as immutable record"]
      },
      "passes": false
    },
    {
      "id": "US-64",
      "epic": "inventory-context",
      "title": "StockLevelRepository Interface",
      "description": "Create repository interface for persisting and retrieving stock levels.",
      "depends_on": ["US-62"],
      "acceptance_criteria": [
        "Extends Repository<StockLevel, StockLevelId>",
        "Methods: findByProductId(ProductId), findByProductIds(Collection<ProductId>)",
        "Interface in application/shared"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["inventory.application.shared.StockLevelRepository"],
        "patterns": ["Repository Interface"]
      },
      "passes": false
    },
    {
      "id": "US-65",
      "epic": "inventory-context",
      "title": "InMemoryStockLevelRepository",
      "description": "Implement in-memory repository for inventory context.",
      "depends_on": ["US-64"],
      "acceptance_criteria": [
        "Implements StockLevelRepository",
        "ConcurrentHashMap-based storage",
        "Secondary index on ProductId",
        "Thread-safe operations"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["inventory.adapter.outgoing.persistence.InMemoryStockLevelRepository"],
        "patterns": ["In-Memory Repository"]
      },
      "passes": false
    },
    {
      "id": "US-66",
      "epic": "inventory-context",
      "title": "GetStockForProducts Use Case",
      "description": "Create bulk stock lookup use case for Cart/Checkout to check availability efficiently.",
      "depends_on": ["US-64"],
      "acceptance_criteria": [
        "GetStockForProductsInputPort extends UseCase",
        "GetStockForProductsQuery(Collection<ProductId> productIds)",
        "GetStockForProductsResult with Map<ProductId, StockData>",
        "StockData record: productId, availableStock, isAvailable"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["inventory.application.getstockforproducts"],
        "patterns": ["Use Case with Query/Result"]
      },
      "passes": false
    },
    {
      "id": "US-67",
      "epic": "inventory-context",
      "title": "InventoryService Open Host Service",
      "description": "Create InventoryService OHS for other contexts to access stock through a stable API.",
      "depends_on": ["US-66"],
      "acceptance_criteria": [
        "@OpenHostService annotation",
        "record StockInfo(ProductId, int availableStock, boolean isAvailable)",
        "getStock(Collection<ProductId>) returns Map<ProductId, StockInfo>",
        "hasStock(ProductId, int quantity) returns boolean",
        "Delegates to GetStockForProductsUseCase"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["inventory.adapter.incoming.openhost.InventoryService"],
        "patterns": ["Open Host Service"]
      },
      "passes": false
    },
    {
      "id": "US-68",
      "epic": "inventory-context",
      "title": "SetStockLevel Use Case",
      "description": "Create use case to set/update stock levels.",
      "depends_on": ["US-64", "US-63"],
      "acceptance_criteria": [
        "SetStockLevelInputPort extends UseCase",
        "SetStockLevelCommand(productId, quantity)",
        "Creates new StockLevel if not exists, updates if exists",
        "Publishes domain events"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["inventory.application.setstocklevel"],
        "patterns": ["Use Case with Command/Result"]
      },
      "passes": false
    },
    {
      "id": "US-69",
      "epic": "inventory-context",
      "title": "Inventory Context ArchUnit Rules",
      "description": "Verify architecture tests cover new inventory context.",
      "depends_on": ["US-67", "US-68"],
      "acceptance_criteria": [
        "Domain has no Spring annotations",
        "Repository interface in application/shared",
        "OHS in adapter/incoming/openhost",
        "All ArchUnit tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": ["test-architecture"],
        "locations": ["Existing ArchUnit tests"],
        "patterns": ["Architecture Testing"]
      },
      "passes": false
    },
    {
      "id": "US-70",
      "epic": "cart-resolver",
      "title": "ArticlePriceResolver Interface",
      "description": "Create functional interface for cart domain to receive fresh pricing without external dependencies.",
      "depends_on": [],
      "acceptance_criteria": [
        "@FunctionalInterface annotation",
        "ArticlePrice resolve(ProductId productId) method",
        "record ArticlePrice(Money price, boolean isAvailable, int availableStock) implements Value",
        "In cart domain package"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["cart.domain.model.ArticlePriceResolver"],
        "patterns": ["Functional Interface", "Value Object"]
      },
      "passes": false
    },
    {
      "id": "US-71",
      "epic": "cart-resolver",
      "title": "CartValidationResult Value Object",
      "description": "Create value object for collecting and returning validation errors.",
      "depends_on": ["US-70"],
      "acceptance_criteria": [
        "record CartValidationResult(List<ValidationError> errors)",
        "isValid() returns errors.isEmpty()",
        "record ValidationError(ProductId productId, String message, ErrorType type)",
        "enum ErrorType { PRODUCT_UNAVAILABLE, INSUFFICIENT_STOCK }",
        "Static factory methods for each error type"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["cart.domain.model.CartValidationResult"],
        "patterns": ["Value Object"]
      },
      "passes": false
    },
    {
      "id": "US-72",
      "epic": "cart-resolver",
      "title": "ShoppingCart Resolver Methods",
      "description": "Add resolver-based methods on ShoppingCart aggregate for calculations using fresh pricing data.",
      "depends_on": ["US-70", "US-71"],
      "acceptance_criteria": [
        "calculateTotal(ArticlePriceResolver) returns Money",
        "validateForCheckout(ArticlePriceResolver) returns CartValidationResult",
        "Keep existing calculateTotal() as @Deprecated for migration",
        "Both methods iterate items and use resolver for pricing"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["cart.domain.model.ShoppingCart"],
        "patterns": ["Aggregate method with injected dependency"]
      },
      "passes": false
    },
    {
      "id": "US-73",
      "epic": "cart-resolver",
      "title": "ArticleDataPort Output Port",
      "description": "Create output port for cart use cases to fetch article data.",
      "depends_on": ["US-58", "US-67"],
      "acceptance_criteria": [
        "Extends OutputPort interface",
        "record ArticleData(ProductId, String name, Money currentPrice, int availableStock, boolean isAvailable)",
        "getArticleData(Collection<ProductId>) returns Map<ProductId, ArticleData>",
        "getArticleData(ProductId) returns Optional<ArticleData>"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["cart.application.shared.ArticleDataPort"],
        "patterns": ["Output Port"]
      },
      "passes": false
    },
    {
      "id": "US-74",
      "epic": "cart-resolver",
      "title": "CompositeArticleDataAdapter",
      "description": "Create composite adapter that aggregates data from multiple Open Host Services.",
      "depends_on": ["US-73", "US-58", "US-67"],
      "acceptance_criteria": [
        "Implements ArticleDataPort",
        "Injects: ProductCatalogService, PricingService, InventoryService",
        "Fetches from all three, combines into ArticleData",
        "Handles missing data gracefully"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["cart.adapter.outgoing.article.CompositeArticleDataAdapter"],
        "patterns": ["Composite Adapter"],
        "constraints": [
          "Only import @OpenHostService classes from other contexts",
          "Never import domain objects from other contexts"
        ]
      },
      "passes": false
    },
    {
      "id": "US-75",
      "epic": "cart-resolver",
      "title": "Update CheckoutCartUseCase with Resolver",
      "description": "Update CheckoutCartUseCase to use resolver pattern for checkout validation with fresh data.",
      "depends_on": ["US-72", "US-74"],
      "acceptance_criteria": [
        "Inject ArticleDataPort",
        "Fetch article data for all cart items",
        "Build resolver from fetched data",
        "Call cart.checkout(resolver) instead of cart.checkout()",
        "Handle validation errors appropriately"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["cart.application.checkoutcart.CheckoutCartUseCase"],
        "patterns": ["Use Case orchestration"]
      },
      "passes": false
    },
    {
      "id": "US-76",
      "epic": "cart-resolver",
      "title": "Update GetCartByIdUseCase with Fresh Data",
      "description": "Update GetCartByIdUseCase to enrich results with fresh pricing.",
      "depends_on": ["US-73", "US-74"],
      "acceptance_criteria": [
        "Inject ArticleDataPort",
        "Fetch article data for all cart items",
        "Include currentPrice and availability in result",
        "Add priceChanged flag if currentPrice != priceAtAddition"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["cart.application.getcartbyid.GetCartByIdUseCase"],
        "patterns": ["Query enrichment"]
      },
      "passes": false
    },
    {
      "id": "US-77",
      "epic": "checkout-resolver",
      "title": "CheckoutArticlePriceResolver Interface",
      "description": "Create functional interface for checkout domain to receive fresh pricing.",
      "depends_on": [],
      "acceptance_criteria": [
        "@FunctionalInterface annotation",
        "ArticlePrice resolve(ProductId productId) method",
        "record ArticlePrice(Money price, boolean isAvailable, int availableStock) implements Value",
        "In checkout domain package"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["checkout.domain.model.CheckoutArticlePriceResolver"],
        "patterns": ["Functional Interface"]
      },
      "passes": false
    },
    {
      "id": "US-78",
      "epic": "checkout-resolver",
      "title": "CheckoutValidationResult Value Object",
      "description": "Create value object for collecting checkout validation errors.",
      "depends_on": ["US-77"],
      "acceptance_criteria": [
        "record CheckoutValidationResult(List<ValidationError> errors)",
        "isValid() returns errors.isEmpty()",
        "Similar structure to CartValidationResult"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["checkout.domain.model.CheckoutValidationResult"],
        "patterns": ["Value Object"]
      },
      "passes": false
    },
    {
      "id": "US-79",
      "epic": "checkout-resolver",
      "title": "CheckoutSession Resolver Methods",
      "description": "Add resolver-based methods on CheckoutSession aggregate for order totals using fresh pricing.",
      "depends_on": ["US-77", "US-78"],
      "acceptance_criteria": [
        "calculateOrderTotal(CheckoutArticlePriceResolver) returns Money",
        "validateItems(CheckoutArticlePriceResolver) returns CheckoutValidationResult",
        "Update confirm() to accept resolver and validate before confirming"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain"],
        "locations": ["checkout.domain.model.CheckoutSession"],
        "patterns": ["Aggregate method with injected dependency"]
      },
      "passes": false
    },
    {
      "id": "US-80",
      "epic": "checkout-resolver",
      "title": "CheckoutArticleDataPort Output Port",
      "description": "Create output port for checkout use cases to fetch article data.",
      "depends_on": ["US-58", "US-67"],
      "acceptance_criteria": [
        "Extends OutputPort interface",
        "record ArticleData(ProductId, String name, Money currentPrice, int availableStock, boolean isAvailable)",
        "getArticleData(Collection<ProductId>) returns Map<ProductId, ArticleData>"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["checkout.application.shared.CheckoutArticleDataPort"],
        "patterns": ["Output Port"]
      },
      "passes": false
    },
    {
      "id": "US-81",
      "epic": "checkout-resolver",
      "title": "CompositeCheckoutArticleDataAdapter",
      "description": "Create composite adapter for checkout to get article data from the right sources.",
      "depends_on": ["US-80", "US-58", "US-67"],
      "acceptance_criteria": [
        "Implements CheckoutArticleDataPort",
        "Injects: ProductCatalogService, PricingService, InventoryService",
        "Same pattern as Cart's CompositeArticleDataAdapter"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["checkout.adapter.outgoing.article.CompositeCheckoutArticleDataAdapter"],
        "patterns": ["Composite Adapter"]
      },
      "passes": false
    },
    {
      "id": "US-82",
      "epic": "checkout-resolver",
      "title": "Update StartCheckoutUseCase with Resolver",
      "description": "Update StartCheckoutUseCase to use resolver pattern for checkout with fresh pricing.",
      "depends_on": ["US-79", "US-81"],
      "acceptance_criteria": [
        "Inject CheckoutArticleDataPort",
        "Fetch article data for all line items",
        "Build resolver from fetched data",
        "Pass resolver to CheckoutSession methods"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["checkout.application.startcheckout.StartCheckoutUseCase"],
        "patterns": ["Use Case orchestration"]
      },
      "passes": false
    },
    {
      "id": "US-83",
      "epic": "checkout-resolver",
      "title": "Update ConfirmCheckoutUseCase with Resolver",
      "description": "Update ConfirmCheckoutUseCase to validate with fresh data before final confirmation.",
      "depends_on": ["US-79", "US-81"],
      "acceptance_criteria": [
        "Inject CheckoutArticleDataPort",
        "Fetch fresh article data before confirmation",
        "Build resolver and call session.confirm(resolver)",
        "Handle validation errors"
      ],
      "architectural_guidance": {
        "affected_layers": ["application"],
        "locations": ["checkout.application.confirmcheckout.ConfirmCheckoutUseCase"],
        "patterns": ["Use Case orchestration"]
      },
      "passes": false
    },
    {
      "id": "US-84",
      "epic": "data-migration",
      "title": "Initialize Pricing Data from Products",
      "description": "Initialize pricing data from existing products on startup.",
      "depends_on": ["US-56"],
      "acceptance_criteria": [
        "AsyncInitialize method in InMemoryProductPriceRepository",
        "Load all products and create ProductPrice for each",
        "Copy price from Product to Pricing context"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["pricing.adapter.outgoing.persistence.InMemoryProductPriceRepository"],
        "patterns": ["Data initialization"]
      },
      "passes": false
    },
    {
      "id": "US-85",
      "epic": "data-migration",
      "title": "Initialize Inventory Data from Products",
      "description": "Initialize inventory data from existing products on startup.",
      "depends_on": ["US-65"],
      "acceptance_criteria": [
        "AsyncInitialize method in InMemoryStockLevelRepository",
        "Load all products and create StockLevel for each",
        "Copy stock quantity from Product to Inventory context"
      ],
      "architectural_guidance": {
        "affected_layers": ["adapter"],
        "locations": ["inventory.adapter.outgoing.persistence.InMemoryStockLevelRepository"],
        "patterns": ["Data initialization"]
      },
      "passes": false
    },
    {
      "id": "US-86",
      "epic": "data-migration",
      "title": "Update Product Context - Remove Pricing Responsibility",
      "description": "Update Product context to no longer manage pricing (separation of concerns).",
      "depends_on": ["US-75", "US-76", "US-82", "US-83"],
      "acceptance_criteria": [
        "Deprecate price-related methods in Product aggregate",
        "ProductCatalogService OHS returns name/SKU only (not price)",
        "Update ProductDataPort in Cart to not expect pricing",
        "Keep Price in Product for now (remove in future story)"
      ],
      "architectural_guidance": {
        "affected_layers": ["domain", "adapter"],
        "locations": ["product.domain.model.Product", "product.adapter.incoming.openhost.ProductCatalogService"],
        "patterns": ["Gradual migration"]
      },
      "passes": false
    },
    {
      "id": "US-87",
      "epic": "data-migration",
      "title": "Integration Tests for Article Data Flow",
      "description": "Create integration tests for the full article data flow to verify resolver pattern works correctly.",
      "depends_on": ["US-74", "US-81", "US-84", "US-85"],
      "acceptance_criteria": [
        "Test CompositeArticleDataAdapter with all three OHS",
        "Test CheckoutCartUseCase with resolver",
        "Test GetCartByIdUseCase enrichment",
        "Test price change detection"
      ],
      "architectural_guidance": {
        "affected_layers": ["test"],
        "locations": ["src/test/java/.../cart/application/"],
        "patterns": ["Integration Testing"]
      },
      "passes": false
    },
    {
      "id": "US-88",
      "epic": "data-migration",
      "title": "Remove Deprecated Price from Product Context",
      "description": "Complete the pricing migration by removing all deprecated price-related code from the Product context.",
      "depends_on": [
        "US-86",
        "US-87"
      ],
      "acceptance_criteria": [
        "Remove price field from Product aggregate",
        "Remove deprecated price() method from Product",
        "Remove deprecated changePrice() method from Product",
        "Remove ProductPriceChanged domain event from Product context",
        "Remove deprecated ProductInfoWithPrice record from ProductCatalogService",
        "Remove deprecated getAllProductsWithInitialPrice() method from ProductCatalogService",
        "Remove transition fallbacks from CompositeArticleDataAdapter",
        "Remove transition fallbacks from CompositeCheckoutArticleDataAdapter",
        "Update CreateProductUseCase to not set price",
        "Update UpdateProductPriceUseCase to use Pricing context or remove",
        "All tests pass after removal"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain",
          "application",
          "adapter"
        ],
        "locations": [
          "product/domain/model/Product.java",
          "product/domain/event/ProductPriceChanged.java",
          "product/adapter/incoming/openhost/ProductCatalogService.java",
          "product/application/createproduct/CreateProductUseCase.java",
          "product/application/updateproductprice/",
          "cart/adapter/outgoing/product/CompositeArticleDataAdapter.java",
          "checkout/adapter/outgoing/product/CompositeCheckoutArticleDataAdapter.java"
        ],
        "patterns": [
          "Migration cleanup",
          "Bounded context separation"
        ]
      },
      "passes": true
    },
    {
      "id": "US-89",
      "epic": "data-migration",
      "title": "Remove Stock Responsibility from Product Context",
      "description": "Remove stock/availability responsibility from Product context since Inventory is the proper owner. Product context should only own identity (productId, sku) and description (name, description, category). This eliminates the duplicated stock data between Product.stock and Inventory.stockLevel.",
      "depends_on": [
        "US-85",
        "US-74",
        "US-81"
      ],
      "acceptance_criteria": [
        "Remove ProductStock value object from Product domain",
        "Remove stock field from Product aggregate",
        "Remove stockQuantity from ProductCatalogService.ProductInfo DTO",
        "Remove hasStock() method from ProductCatalogService",
        "Remove ProductDataPort from Cart context (no longer needed)",
        "Remove ProductDataAdapter from Cart context",
        "Update AddItemToCartUseCase to use only ArticleDataPort for validation",
        "CompositeArticleDataAdapter uses InventoryService for stock (not ProductCatalogService)",
        "Update CreateProductCommand to not require stockQuantity",
        "Update CreateProductUseCase to not set stock",
        "All tests pass: ./gradlew build, ./gradlew test-architecture"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain",
          "application",
          "adapter"
        ],
        "locations": [
          "product/domain/model/ProductStock.java (DELETE)",
          "product/domain/model/Product.java (remove stock field)",
          "product/adapter/incoming/openhost/ProductCatalogService.java",
          "cart/application/shared/ProductDataPort.java (DELETE)",
          "cart/adapter/outgoing/product/ProductDataAdapter.java (DELETE)",
          "cart/application/additemtocart/AddItemToCartUseCase.java",
          "cart/adapter/outgoing/product/CompositeArticleDataAdapter.java",
          "product/application/createproduct/CreateProductCommand.java",
          "product/application/createproduct/CreateProductUseCase.java"
        ],
        "patterns": [
          "Bounded Context Separation",
          "Single Source of Truth"
        ],
        "constraints": [
          "Inventory context is the single source of truth for stock",
          "Product context owns only identity and descriptive information",
          "No stock-related methods or fields in Product context after completion",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": true
    },
    {
      "id": "US-90",
      "epic": "enriched-cart-pattern",
      "title": "CheckoutArticle Domain Value Object",
      "description": "Promote ArticleData from application port to proper domain value object. Currently ArticleData is nested inside CheckoutArticleDataPort (application layer), preventing domain logic from using it directly. Create CheckoutArticle as a domain-level value object that represents checkout's view of article data from external contexts.\n\nBefore starting, check tasks/logs/ folder for US-89 result to understand the current article data flow, or check git history for recent changes to the checkout context.",
      "depends_on": [
        "US-89"
      ],
      "acceptance_criteria": [
        "CheckoutArticle record in checkout/domain/model/",
        "Fields: ProductId productId, String name, Money currentPrice, int availableStock, boolean isAvailable",
        "Implements Value interface",
        "Method: hasStockFor(int quantity) returns boolean",
        "Validation: productId not null, name not blank, currentPrice not null, availableStock >= 0",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "checkout/domain/model/CheckoutArticle.java"
        ],
        "patterns": [
          "Value Object",
          "Anti-Corruption Layer"
        ],
        "constraints": [
          "This is checkout context's representation of external article data",
          "Domain value objects must be immutable (Java record)",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-91",
      "epic": "enriched-cart-pattern",
      "title": "EnrichedCheckoutLineItem Value Object",
      "description": "Create value object that combines a CheckoutLineItem with current CheckoutArticle data. This enables domain logic like 'has price changed since item was added' and 'is stock sufficient for this quantity'.\n\nBefore starting, check tasks/logs/ folder for US-90 result to understand the CheckoutArticle structure.",
      "depends_on": [
        "US-90"
      ],
      "acceptance_criteria": [
        "EnrichedCheckoutLineItem record in checkout/domain/model/",
        "Fields: CheckoutLineItem lineItem, CheckoutArticle currentArticle",
        "Implements Value interface",
        "Method: currentLineTotal() returns Money (currentPrice * quantity)",
        "Method: originalLineTotal() returns Money (lineItem.lineTotal())",
        "Method: hasPriceChanged() returns boolean",
        "Method: priceDifference() returns Money",
        "Method: hasSufficientStock() returns boolean",
        "Method: isValidForCheckout() returns boolean (available AND sufficient stock)",
        "Validation: productId must match between lineItem and currentArticle",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "checkout/domain/model/EnrichedCheckoutLineItem.java"
        ],
        "patterns": [
          "Value Object",
          "Enriched Read Model"
        ],
        "constraints": [
          "Encapsulates comparison logic between original and current data",
          "Implements 'smart cart display' metaphor",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-92",
      "epic": "enriched-cart-pattern",
      "title": "CheckoutCart Domain Value Object",
      "description": "Create the 'smart shopping cart' value object that contains enriched line items and provides business methods for validation and calculations. This is like a shopping cart with a display that shows running total, current prices, and alerts for price changes.\n\nBefore starting, check tasks/logs/ folder for US-91 result to understand the EnrichedCheckoutLineItem structure.",
      "depends_on": [
        "US-91"
      ],
      "acceptance_criteria": [
        "CheckoutCart record in checkout/domain/model/",
        "Fields: CartId cartId, CustomerId customerId, List<EnrichedCheckoutLineItem> items",
        "Implements Value interface",
        "Method: calculateCurrentSubtotal() returns Money",
        "Method: calculateOriginalSubtotal() returns Money",
        "Method: totalPriceDifference() returns Money",
        "Method: hasAnyPriceChanges() returns boolean",
        "Method: itemsWithPriceChanges() returns List<EnrichedCheckoutLineItem>",
        "Method: isValidForCheckout() returns boolean",
        "Method: invalidItems() returns List<EnrichedCheckoutLineItem>",
        "Method: unavailableItems() returns List<EnrichedCheckoutLineItem>",
        "Method: itemsWithInsufficientStock() returns List<EnrichedCheckoutLineItem>",
        "Method: itemCount() and totalQuantity()",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "checkout/domain/model/CheckoutCart.java"
        ],
        "patterns": [
          "Value Object",
          "Enriched Read Model",
          "Smart Cart Pattern"
        ],
        "constraints": [
          "Not an Aggregate - just a read model Value Object",
          "Business logic for checkout validation lives here",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-93",
      "epic": "enriched-cart-pattern",
      "title": "CheckoutCartFactory",
      "description": "Create factory to assemble CheckoutCart from checkout line items and article data. The factory encapsulates the complex assembly of enriched line items.\n\nBefore starting, check tasks/logs/ folder for US-92 result to understand the CheckoutCart structure.",
      "depends_on": [
        "US-92"
      ],
      "acceptance_criteria": [
        "CheckoutCartFactory class in checkout/domain/model/",
        "Implements Factory marker interface",
        "Method: create(CartId, CustomerId, List<CheckoutLineItem>, Map<ProductId, CheckoutArticle>) returns CheckoutCart",
        "Method: fromSession(CheckoutSession, Map<ProductId, CheckoutArticle>) returns CheckoutCart",
        "Validates that all line items have corresponding article data",
        "Throws IllegalArgumentException if article data missing for any line item",
        "Framework-independent (no Spring annotations)",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "checkout/domain/model/CheckoutCartFactory.java"
        ],
        "patterns": [
          "Factory Pattern (DDD)",
          "Cross-Context Assembly"
        ],
        "constraints": [
          "Factory is domain-level, not application-level",
          "Application layer fetches data via ports, passes to factory",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-94",
      "epic": "enriched-cart-pattern",
      "title": "Update CheckoutArticleDataPort to Return Domain Objects",
      "description": "Refactor CheckoutArticleDataPort to return CheckoutArticle domain objects instead of nested ArticleData DTOs. Update the CompositeCheckoutArticleDataAdapter to return the new domain type.\n\nBefore starting, check tasks/logs/ folder for US-93 result to understand the factory pattern usage.",
      "depends_on": [
        "US-93"
      ],
      "acceptance_criteria": [
        "CheckoutArticleDataPort returns Map<ProductId, CheckoutArticle>",
        "Remove nested ArticleData record from CheckoutArticleDataPort",
        "Update CompositeCheckoutArticleDataAdapter to build CheckoutArticle objects",
        "Update StartCheckoutUseCase to use CheckoutArticle and CheckoutCartFactory",
        "Update ConfirmCheckoutUseCase to use CheckoutArticle",
        "Keep CheckoutArticlePriceResolver for backward compatibility with confirm() method",
        "All tests pass: ./gradlew build",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "application",
          "adapter"
        ],
        "locations": [
          "checkout/application/shared/CheckoutArticleDataPort.java",
          "checkout/adapter/outgoing/product/CompositeCheckoutArticleDataAdapter.java",
          "checkout/application/startcheckout/StartCheckoutUseCase.java",
          "checkout/application/confirmcheckout/ConfirmCheckoutUseCase.java"
        ],
        "patterns": [
          "Output Port",
          "Adapter Pattern"
        ],
        "constraints": [
          "Ports should return domain objects, not DTOs",
          "Adapter translates OHS data to domain value objects",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-95",
      "epic": "enriched-cart-pattern",
      "title": "CartArticle Domain Value Object",
      "description": "Create CartArticle domain value object in Cart context (mirroring CheckoutArticle). This promotes ArticleData from the ArticleDataPort to a proper domain concept.\n\nBefore starting, check tasks/logs/ folder for US-90 result to see the equivalent CheckoutArticle implementation as reference.",
      "depends_on": [
        "US-90"
      ],
      "acceptance_criteria": [
        "CartArticle record in cart/domain/model/",
        "Fields: ProductId productId, String name, Money currentPrice, int availableStock, boolean isAvailable",
        "Implements Value interface",
        "Method: hasStockFor(int quantity) returns boolean",
        "Same structure as CheckoutArticle (context-specific ownership)",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "cart/domain/model/CartArticle.java"
        ],
        "patterns": [
          "Value Object",
          "Anti-Corruption Layer"
        ],
        "constraints": [
          "Each bounded context owns its value object definition",
          "Same structure as CheckoutArticle is intentional (context isolation)",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-96",
      "epic": "enriched-cart-pattern",
      "title": "EnrichedCartItem Value Object",
      "description": "Create value object that combines a CartItem with current CartArticle data in the Cart context.\n\nBefore starting, check tasks/logs/ folder for US-91 and US-95 results for reference.",
      "depends_on": [
        "US-95"
      ],
      "acceptance_criteria": [
        "EnrichedCartItem record in cart/domain/model/",
        "Fields: CartItem cartItem, CartArticle currentArticle",
        "Implements Value interface",
        "Method: currentLineTotal() returns Money",
        "Method: originalLineTotal() returns Money (priceAtAddition * quantity)",
        "Method: hasPriceChanged() returns boolean",
        "Method: priceDifference() returns Money",
        "Method: hasSufficientStock() returns boolean",
        "Method: isValidForCheckout() returns boolean",
        "Validation: productId must match",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "cart/domain/model/EnrichedCartItem.java"
        ],
        "patterns": [
          "Value Object",
          "Enriched Read Model"
        ],
        "constraints": [
          "Mirror structure of EnrichedCheckoutLineItem",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-97",
      "epic": "enriched-cart-pattern",
      "title": "EnrichedCart Domain Value Object",
      "description": "Create the 'smart shopping cart' value object for Cart context with enriched items and business methods.\n\nBefore starting, check tasks/logs/ folder for US-92 and US-96 results for reference.",
      "depends_on": [
        "US-96"
      ],
      "acceptance_criteria": [
        "EnrichedCart record in cart/domain/model/",
        "Fields: CartId cartId, CustomerId customerId, List<EnrichedCartItem> items, CartStatus status",
        "Implements Value interface",
        "Method: calculateCurrentSubtotal() returns Money",
        "Method: calculateOriginalSubtotal() returns Money",
        "Method: totalPriceDifference() returns Money",
        "Method: hasAnyPriceChanges() returns boolean",
        "Method: itemsWithPriceChanges() returns List<EnrichedCartItem>",
        "Method: isValidForCheckout() returns boolean",
        "Method: invalidItems() returns List<EnrichedCartItem>",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "cart/domain/model/EnrichedCart.java"
        ],
        "patterns": [
          "Value Object",
          "Enriched Read Model",
          "Smart Cart Pattern"
        ],
        "constraints": [
          "Mirror structure of CheckoutCart",
          "Not an Aggregate - read model only",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-98",
      "epic": "enriched-cart-pattern",
      "title": "EnrichedCartFactory",
      "description": "Create factory to assemble EnrichedCart from ShoppingCart and article data.\n\nBefore starting, check tasks/logs/ folder for US-93 and US-97 results for reference.",
      "depends_on": [
        "US-97"
      ],
      "acceptance_criteria": [
        "EnrichedCartFactory class in cart/domain/model/",
        "Implements Factory marker interface",
        "Method: create(ShoppingCart, Map<ProductId, CartArticle>) returns EnrichedCart",
        "Validates that all cart items have corresponding article data",
        "Framework-independent",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "domain"
        ],
        "locations": [
          "cart/domain/model/EnrichedCartFactory.java"
        ],
        "patterns": [
          "Factory Pattern (DDD)"
        ],
        "constraints": [
          "Mirror structure of CheckoutCartFactory",
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-99",
      "epic": "enriched-cart-pattern",
      "title": "Update ArticleDataPort to Return Domain Objects",
      "description": "Refactor ArticleDataPort to return CartArticle domain objects. Update the CompositeArticleDataAdapter and use cases.\n\nBefore starting, check tasks/logs/ folder for US-94 and US-98 results for reference.",
      "depends_on": [
        "US-98"
      ],
      "acceptance_criteria": [
        "ArticleDataPort returns Map<ProductId, CartArticle>",
        "Remove nested ArticleData record from ArticleDataPort",
        "Update CompositeArticleDataAdapter to build CartArticle objects",
        "Update GetCartByIdUseCase to use CartArticle and EnrichedCartFactory",
        "Update CheckoutCartUseCase to use EnrichedCart for validation",
        "Keep ArticlePriceResolver for backward compatibility",
        "All tests pass: ./gradlew build",
        "Architecture tests pass"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "application",
          "adapter"
        ],
        "locations": [
          "cart/application/shared/ArticleDataPort.java",
          "cart/adapter/outgoing/product/CompositeArticleDataAdapter.java",
          "cart/application/getcartbyid/GetCartByIdUseCase.java",
          "cart/application/checkoutcart/CheckoutCartUseCase.java"
        ],
        "patterns": [
          "Output Port",
          "Adapter Pattern"
        ],
        "constraints": [
          "Run ./gradlew test-architecture to verify"
        ]
      },
      "passes": false
    },
    {
      "id": "US-100",
      "epic": "enriched-cart-pattern",
      "title": "Document Enriched Cart Patterns",
      "description": "Document the new patterns in architecture documentation: Composite Adapter, Enriched Read Model, Factory for Cross-Context Assembly.\n\nBefore starting, check tasks/logs/ folder for US-94 and US-99 results to see the completed implementations.",
      "depends_on": [
        "US-94",
        "US-99"
      ],
      "acceptance_criteria": [
        "Add 'Composite Adapter Pattern' section to architecture-principles.md",
        "Add 'Enriched Read Model Pattern' section to architecture-principles.md",
        "Add 'Factory for Cross-Context Assembly' section to architecture-principles.md",
        "Include code examples from actual implementations",
        "Update implementing-domain-centric-architecture/README.md if applicable",
        "Documentation follows concise style (no bloat)"
      ],
      "architectural_guidance": {
        "affected_layers": [
          "documentation"
        ],
        "locations": [
          "docs/architecture/architecture-principles.md",
          "implementing-domain-centric-architecture/README.md"
        ],
        "patterns": [
          "Documentation"
        ],
        "constraints": [
          "Keep documentation concise and to the point",
          "Include real code examples from implementation",
          "Link to related docs instead of duplicating"
        ]
      },
      "passes": false
    }
  ]
}
